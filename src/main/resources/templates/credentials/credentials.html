<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <title>Store credentials</title>
  </head>
  <body>
    <div layout:fragment="content">
      <section>
        <div id="alert-container">
          <!-- create credential successful alert -->
          <div
            class="alert alert-success alert-dismissible float-left fade"
            role="alert"
            id="alert-success-note-create"
          >
            <span id="alert-message-success-note-create"
              >Great! A new note has been successfully added!</span
            >
            <button
              type="button"
              class="close"
              data-dismiss="alert"
              aria-label="Close"
              id="alert-close-success-note-create"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <!-- update credential successful alert -->
          <div
            class="alert alert-success alert-dismissible float-left fade"
            role="alert"
            id="alert-success-note-update"
          >
            <span id="alert-message-success-note-update"
              >The note you selected has been updated!</span
            >
            <button
              type="button"
              class="close"
              data-dismiss="alert"
              aria-label="Close"
              id="alert-close-success-note-update"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <!-- delete credential successful alert -->
          <div
            class="alert alert-success alert-dismissible float-left fade"
            role="alert"
            id="alert-success-note-delete"
          >
            <span id="alert-message-success-note-delete"
              >The note has been removed</span
            >
            <button
              type="button"
              class="close"
              data-dismiss="alert"
              aria-label="Close"
              id="alert-close-success-note-delete"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </div>

        <button
          style="margin: 0.25em"
          type="button"
          class="btn btn-info float-right"
          data-toggle="modal"
          data-target="#credential-modal"
        >
          + Add a New Credential
        </button>

        <!-- list showing all notes -->
        <div class="table-responsive">
          <table class="table table-striped" id="credentialTable">
            <thead>
              <tr>
                <th style="width: 20%" scope="col"></th>
                <th style="width: 35%" scope="col">URL</th>
                <th style="width: 20%" scope="col">Username</th>
                <th style="width: 25%" scope="col">Password</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="credential : ${credentialList}">
                <td>
                  <a
                    class="btn btn-success"
                    th:href="@{'/credentials/'+${credential.credentialId}}"
                    th:id="'credential-button-'+${credential.credentialId}"
                    th:attr="data-credential-id=${credential.credentialId},data-credential-url=${credential.url},data-credential-username=${credential.username},data-credential-password=${decryptedPasswordOfCredentialBeingViewed}"
                    >Edit</a
                  >
                  <a
                    class="btn btn-danger"
                    data-toggle="modal"
                    data-target="#credential-delete-modal"
                    th:id="'credential-delete-button-'+${credential.credentialId}"
                    th:attr="data-credential-id=${credential.credentialId},data-credential-url=${credential.url}"
                    >Delete</a
                  >
                </td>
                <th scope="row" th:text="${credential.url}">
                  Example Credential URL
                </th>
                <td th:text="${credential.username}">
                  Example Credential Username
                </td>
                <td th:text="${credential.password}">
                  Example Credential Password
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- note create, update modal -->
      <div
        class="modal fade"
        id="credential-modal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="credentialModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="credentialModalLabel">Credential</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form
                action="#"
                method="POST"
                th:action="@{/credentials/add}"
                th:object="${newCredential}"
                id="credential-modal-form"
              >
                <input type="hidden" name="credentialId" id="credential-id" />
                <div class="form-group">
                  <label for="credential-url" class="col-form-label">URL</label>
                  <input
                    type="text"
                    name="url"
                    class="form-control"
                    id="credential-url"
                    maxlength="100"
                    required
                    th:field="*{url}"
                  />
                </div>
                <div class="form-group">
                  <label for="credential-username" class="col-form-label"
                    >Username</label
                  >
                  <input
                    type="text"
                    name="username"
                    class="form-control"
                    id="credential-username"
                    maxlength="30"
                    required
                    th:field="*{username}"
                  />
                </div>
                <div class="form-group">
                  <label for="credential-password" class="col-form-label"
                    >Password</label
                  >
                  <input
                    type="text"
                    name="password"
                    class="form-control"
                    id="credential-password"
                    maxlength="30"
                    required
                    th:field="*{password}"
                  />
                </div>
                <button
                  id="credentialSubmit"
                  type="submit"
                  class="d-none"
                ></button>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="$('#credentialSubmit').click();"
              >
                Save changes
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- note delete modal -->
      <div
        class="modal fade"
        id="credential-delete-modal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="credentialModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="credentialDeleteModal">Note</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <span id="credential-delete-confirmation-message">
                Do you want to delete this credential?
              </span>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <a class="btn btn-primary" id="credential-delete-link">Delete</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <th:block layout:fragment="scripts">
      <script src="/js/notes/.js" th:src="@{/js/credentials.js}"></script>
    </th:block>
  </body>
</html>
